<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="jxau.spms.dao"><!-- namespace必须是与接口的包路径一致，不然会报错误 -->

    <!--<cache eviction="FIFO" flushInterval="60000" size="512" readOnly="true" /> --><!-- Mybaties内置二级缓存 -->
    <!-- 查询返回集合类型的配置 -->
    <!-- 查询返回集合类型的配置 -->
    <!-- 使用第三方缓存插件实现二级缓存-->
   
    <!--获取学生开题报告-->
    <select id="selectStuReport" parameterType="java.util.Map"  resultType="jxau.spms.common.vo.ReportInfoVo">
		select si.subName,si.studentNo,sb.studentName,ri.uploadTime,ri.exameState,ri.identifier
		from report_info ri 
		inner join subject_info si 
		on si.studentNo = ri.studentNo 
		inner join stu_basic_info sb
		on sb.studentNo = ri.studentNo
		where ri.tutorNo = #{tutorNo}
		<if test="reportTerm != null">
			and ri.reportTerm = #{reportTerm}
		</if>
		<if test="start != null">
			limit #{start},#{number}
		</if>
		;
    </select>
    <!--获取开题报告的数量-->
    <select id="selectReportNum" parameterType="java.util.Map"  resultType="int">
		select count(*) from report_info ri inner join stu_basic_info sb
		on sb.studentNo = ri.studentNo
		inner join subject_info si 
		on si.studentNo = ri.studentNo 
		where ri.tutorNo = #{tutorNo}
		<if test="reportTerm != null">
			and ri.reportTerm = #{reportTerm}
		</if>
		;
    </select>
     <!--学生获取任务书信息-->
    <select id="selectTaskInfo" parameterType="java.util.Map"  resultType="jxau.spms.common.vo.TaskInfoVo">
		select si.subName,ti.content,ti.diagram,ti.indicator,ti.schedule,ti.reference
		from subject_info si inner join task_info ti
		on si.subjectNo = ti.subjectNo
		where
		<if test="term != null">
			si.subTerm = #{term} and
		</if>
			si.studentNo = #{studentNo}
		;
    </select>
     <!--添加信息-->
    <insert id="addReportInfo" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="reportNo">
		insert into report_info values
			(#{reportNo},#{studentNo},#{tutorNo},#{uploadTime},
			 #{exameState},#{memo},#{reportTerm},#{identifier});
    </insert>
    <!--添加信息-->
    <insert id="addTaskInfo" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="taskNo">
		insert into task_info values
			(null,#{subjectNo},#{content},#{diagram},
			 #{indicator},#{schedule},#{reference});
    </insert>
</mapper>
